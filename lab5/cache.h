#ifndef CACHE_H
#define CACHE_H

#include "types.h"

#define MAX_WAYS 8

#define TBR_ENTRIES (1<<20)

typedef struct Cache_Line Cache_Line;
typedef struct Cache_Set Cache_Set;
typedef struct Cache Cache;

//////////////////////////////////////////////////////////////////////////////////////
//////////////////////////////////////////////////////////////////////////////////////


struct Cache_Line {
    Flag    valid;
    Addr    tag;
};


struct Cache_Set {
    Cache_Line line[MAX_WAYS];
};


struct Cache{
  uns num_sets;
  uns num_ways;
  
  uns tbr[TBR_ENTRIES]; // Table based randomizer

  Cache_Set *sets;
};


/////////////////////////////////////////////////////////////////////////////////////////////
//////////////////////////////////////////////////////////////////////////////////////////////

Cache  *cache_new            (uns assocs);
Flag    cache_access_install (Cache *c, uns lineaddr);

void    cache_reset          (Cache *c);

//////////////////////////////////////////////////////////////////////////////////////////////
//////////////////////////////////////////////////////////////////////////////////////////////

#endif // CACHE_H
